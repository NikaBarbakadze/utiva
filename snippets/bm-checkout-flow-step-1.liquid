<style>
  html body {
    position: relative;
  }

  html body .bm-mini-cart {
    position: fixed;
    top: 0;
    right: 0;
    border-radius: 10px 0 10px 10px;
    box-shadow: 0px 5px 10px 2px rgba(0, 0, 0, 0.25);
    max-width: 440px;
    width: 100%;
    z-index: 99;
    background: #fff;
    display: none;
  }

  html body .bm-mini-cart.bm-active {
    display: block;
  }

  html body .bm-mini-cart .bm-content {
    display: block;
    margin: auto;
  }

  html body .bm-mini-cart .bm-bg-white {
    border-radius: 10px 10px 0 0;
  }

  html body .bm-mini-cart .bm-bg-black {
    background-color: #010101;
    border-radius: 0 0 10px 10px;
    display: block;
    margin: auto;
  }

  html body .bm-mini-cart .bm-bg-black p {
    color: #fff;
    font-size: 16px;
    line-height: 22px;
    display: block;
    margin: auto;
    text-align: center;
  }

  html body .bm-mini-cart .container {
    margin: 0;
    padding: 20px 25px;
  }

  html body .bm-mini-cart .bm-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.25);
    position: relative;
  }

  html body .bm-mini-cart .bm-header h2 {
    font-size: 20px;
    margin: auto;
    padding: 0 20px 20px 10px;
    font-weight: 700;
    text-align: left;
    line-height: 24px;
  }

  html body .bm-mini-cart .bm-header img {
    position: absolute;
    top: 5px;
    right: 0;
    cursor: pointer;
    width: 16px;
  }

  html body .bm-mini-cart .bm-pro-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 5px;
  }

  html body .bm-mini-cart .bm-products {
    margin-bottom: 20px;
  }

  html body .bm-mini-cart .bm-products li {
    margin: 15px auto;
    list-style-type: none;
  }

  html body .bm-mini-cart .bm-pro-details img {
    width: 100px;
    margin-left: 10px;
  }

  html body .bm-mini-cart .bm-pro-details p.bm-name {
    font-size: 18px;
    line-height: 24px;
    color: rgba(0, 0, 0, 0.5);
    font-weight: 700;
    font-family: 'Nunito';
    padding: 0 10px;
  }

  html body .bm-mini-cart .bm-pro-details p.bm-quantity {
    font-size: 16px;
    line-height: 24px;
    color: rgba(0, 0, 0, 0.5);
    width: 60px;
  }

  html body .bm-mini-cart .bm-body a {
    display: block;
    margin: auto;
    margin-bottom: 20px;
    text-decoration: none;
    text-align: center;
  }

  html body .bm-mini-cart .bm-body .bm-cart-link {
    color: #fff;
    background-color: #db222d;
    font-size: 24px;
    line-height: 30px;
    padding: 10px;
    border-radius: 50px;
  }

  html body .bm-mini-cart .bm-body .bm-shop-link {
    color: rgba(0, 0, 0, 0.5);
    font-size: 16px;
    line-height: 20px;
    cursor: pointer;
    display: block;
    margin: auto;
    margin-bottom: 20px;
    text-align: center;
  }

  html body .bm-mini-cart .bm-body .bm-shop-link span {
    padding-bottom: 4px;
    border-bottom: 1.5px solid rgba(0, 0, 0, 0.25);
  }

  html body .bm-mini-cart .bm-body h4 {
    font-size: 20px;
    margin: 30px auto auto;
    font-weight: 700;
    text-align: center;
    line-height: 24px;
  }

  @media screen and (max-width:480px) {
    html body .bm-mini-cart {
      border-radius: 0 0 10px 10px;
      max-width: 100%;
    }
  }

  @media screen and (max-width:767px) {
    html body .bm-mini-cart .container {
      padding: 15px 20px;
    }
  }

  </style>
<script >
  (function () {
    var debug = 0;
    var variation_name = "Utiva checkout flow from GrowthHit design";

    if (window.location.href.indexOf('qa-debug') > -1 || localStorage.getItem('qa_debug')) {
      debug = 1;
      localStorage.setItem('qa_debug', true);
      console.log('>> ' + variation_name);
    }

    try {
      function waitForElement(selector, trigger, delayInterval, delayTimeout) {
        var interval = setInterval(function () {
          if (
            document &&
            document.querySelector(selector) &&
            document.querySelectorAll(selector).length > 0
          ) {
            clearInterval(interval);
            trigger();
          }
        }, delayInterval);
        setTimeout(function () {
          clearInterval(interval);
        }, delayTimeout);
      }

      function debugMessage(message) {
        if (debug) {
          console.log(message);
        }
      }

      var bmString = '' +
          '  <section class="bm-mini-cart">' +
          '      <div class="container bm-bg-white">' +
          '          <div class="bm-content">' +
          '              <div class="bm-header">' +
          '                  <h2>Just added to your cart</h2>' +
          '                  <img src="https://bm-test-dev.s3.us-east-2.amazonaws.com/growthHit/Copper/test19/Cross_icon.svg" alt="">' +
          '              </div>' +
          '              <div class="bm-body">' +
          '                  <ul class="bm-products">' +
          '                     <li>' +
          '                         <div class="bm-pro-details">' +
          '                             <img src="" alt="">' +
          '                             <P class="bm-name"></P>' +
          '                             <p class="bm-quantity">Qty:<span></span></p>' +
          '                         </div>' +
          '                     </li>'+
          '                  </ul>' +
          '                  <a class="bm-cart-link" href="https://www.utivahealth.com/cart">View Cart (<span>1</span>)</a>' +
          '                  <a class="bm-shop-link" href="/"><span>Continue shopping</span></a>' +
          '                  <h4 class="bm-shipping-msg">Wait, don\'t pay for shipping</h4>' +
          '              </div>' +
          '          </div>' +
          '      </div>' +
          '      <div class="container bm-bg-black">' +
          '          <div class="bm-content">' +
          '              <p class="bm-shipping-remind">You are only $<span>10.01</span> away from free shipping</p>' +
          '          </div>' +
          '      </div>' +
          '  </section>';


      // var b = a.split(":")[1];
      // var bmImgURL = bmImgStyle.replace(/(^.*\(|\).*$)/g, '');

      function bmFreeShippShippping() {
        var bmFreeShippingAmount = 25;
        var bmSubTotal = document.querySelector('#CartDrawer .cart__detail-info > span').innerHTML;
        var bmSubTotalNum = parseFloat(bmSubTotal.split("$")[1]);

        if (bmSubTotalNum < bmFreeShippingAmount) {
          var bmLessAmount = (bmFreeShippingAmount - bmSubTotalNum).toFixed(2);
          document.querySelector('.bm-mini-cart .bm-bg-black p.bm-shipping-remind span').innerHTML = bmLessAmount;
        }
        else {
          var bmFreeShippingText = 'You\'ve earned free shipping!';
          document.querySelector('.bm-mini-cart .bm-bg-black p.bm-shipping-remind').innerHTML = bmFreeShippingText;
          document.querySelector('.bm-mini-cart .bm-body .bm-shipping-msg').innerHTML = '';
        }
      }

      function bmMiniCartUpdate() {
        document.querySelector('.bm-mini-cart').classList.add('bm-active');
        var bmCartQ = document.querySelector('.header-item a[href="/cart"] .cart-link__bubble span').innerHTML;
        var bmCartQuantity = parseInt(bmCartQ);
        document.querySelector('.bm-mini-cart a.bm-cart-link span').innerHTML = bmCartQuantity;
        // document.querySelector('.bm-mini-cart .bm-body ul').innerHTML = '';
        bmCheckoutCart();
        bmFreeShippShippping();
      }

      function bmCheckoutCart() {
        var bmCheckout = document.querySelectorAll('#CartDrawer .cart__items .cart__item');
        bmCheckout.forEach(function (item, index) {

          var bmImgParent = item.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;
          var bmImgData;
          if (bmImgParent.querySelector('.product__slide.slick-current.slick-active .image-wrap > img')) { 
            bmImgData = bmImgParent.querySelector('.product__slide.slick-current.slick-active .image-wrap > img').getAttribute('data-photoswipe-src');
            document.querySelector('.bm-mini-cart .bm-pro-details img').setAttribute('src', bmImgData);
          }
          else {
            bmImgData = bmImgParent.querySelector('.product__main-photos .product__slide .image-wrap > img').getAttribute('data-photoswipe-src');
            document.querySelector('.bm-mini-cart .bm-pro-details img').setAttribute('src', bmImgData);
          }

          var bmQuantityData = document.querySelector('form[action="/cart/add"] .quantity > input[type="number"]').value;
          document.querySelector('.bm-mini-cart .bm-pro-details .bm-quantity span').innerHTML = bmQuantityData;

          var bmNameData = document.querySelector('.product-single__meta .h1.product-single__title').innerHTML;
          document.querySelector('.bm-mini-cart .bm-pro-details .bm-name').innerHTML = bmNameData;
        });
      }

      //function init
      function init() {
        debugMessage('>> init Utiva checkout flow');
        document.querySelector('body').insertAdjacentHTML('beforeend', bmString);

        var bmAddToCart = document.querySelectorAll('button.bm-add-to-cart[type="submit"][name="add"]');
        bmAddToCart.forEach(function (item, index) {
          item.addEventListener('click', function (e) {
            setTimeout(function () {
              bmMiniCartUpdate();
              if (document.querySelector('#CartDrawer .js-drawer-close')) {
                document.querySelector('#CartDrawer .js-drawer-close').click();
              }
            }, 1500);
          });
        });


        document.querySelector('.bm-mini-cart .bm-header img').addEventListener('click', function () {
          document.querySelector('.bm-mini-cart').classList.remove('bm-active');
          // document.querySelector('.bm-mini-cart .bm-body ul').innerHTML = '';
        });
      }

      //helper function to init
      waitForElement('#shopify-section-bm-control-template-bottom button.bm-add-to-cart[type="submit"][name="add"]',
                     init, 50, 20000);

      //Ajax call
      var bmSend = XMLHttpRequest.prototype.send;
      XMLHttpRequest.prototype.send = function () {
        this.addEventListener('load', function () {
          if (this.responseURL.indexOf('/cart/add') > -1) {
            //onVriationChange
            waitForElement('.site-nav__icons a[href="/cart"] .cart-link__count', init, 50, 20000);
          }
        });

        return bmSend.apply(this, arguments);
      };
    } catch (e) {
      if (debug) console.log(e, "error in Test" + variation_name);
    }
  })();
</script>
